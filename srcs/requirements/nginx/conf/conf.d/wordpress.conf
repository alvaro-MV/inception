##
# WordPress reverse proxy rules for Nginx + PHP-FPM (FastCGI)
# Designed for single-site WordPress inside Docker.
##

# üîó Upstream PHP-FPM service (nombre del contenedor en docker-compose)
upstream php {
    # PHP-FPM escucha en el contenedor "wordpress" puerto 9000
    server wordpress:9000;
}

server {
    # Nombre del dominio configurado en /etc/hosts (login.42.fr o localhost)
    server_name alvmoral.42.fr;
    root /var/www/html;          # Ruta donde est√° WordPress
    index index.php index.html;

    # üß± Incluir reglas de seguridad globales
    include /etc/nginx/conf.d/restricciones.conf;

    # üöÄ Peticiones normales
    location / {
        # Intenta servir el fichero o directorio, si no, pasa a index.php
        # El "$args" mantiene la query string original (por compatibilidad con permalinks)
        try_files $uri $uri/ /index.php?$args;
    }

    # üß© Ejecuci√≥n de PHP mediante FastCGI ‚Üí PHP-FPM
    location ~ \.php$ {
        include fastcgi.conf;         # Variables FastCGI est√°ndar
        fastcgi_intercept_errors on;  # Permite a Nginx manejar errores 4xx/5xx
        fastcgi_pass php;             # Envia a upstream "php" (wordpress:9000)
    }

    # üñºÔ∏è Archivos est√°ticos: cachearlos agresivamente
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|webp|woff2?)$ {
        expires max;
        add_header Cache-Control "public, immutable";
        log_not_found off;
    }
}
